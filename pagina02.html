<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista</title>
    <link rel="stylesheet" href="style02.css">
</head>
<body>
    <div id="editmodal">
        <div id='backgroundmodal'></div>
            <div id='modal'></div>
    </div>
 
    <header>
        <button id="form"><a href="formulario.html">Formulário</a></button>
        <button id="list"><a href="pagina02.html">Lista</a></button>
    </header>

    <section>
        <h1>Lista de dados</h1>
        <div id="msg"></div>
    </section>

    <div id="modalform" style="display: none;">
        <div id="modalform2">
            <label for="nome">Nome Completo</label>
            <input type="text" name="nome" id="nome" required>
        </div>

        <div id="modalform2">
            <label for="tel">Telefone</label>
            <input type="tel" name="tel" id="tel" maxlength="11" required>
        </div>

        <div id="modalform2">
            <label for="estado">Estado</label>
            <select name="estado" id="estado" required onchange ="atualizarCidades()">
                <option value="" disabled selected>Selecione um estado</option>
                <option value="sc">Santa Catarina</option>
                <option value="rs">Rio Grande do Sul</option>
                <option value="pr">Paraná</option>
            </select>
        </div>

        <div id="modalform2">
            </select>
            <label for="cidade">Cidade</label>
            <select name="cidade" id="cidade" required>
                <option value=""disabled selected>Selecione um estado primeiro</option>
            </select>
        </div>

   </div>
<script>
const cidadesPorEstado = {
            sc: ["Jaguaruna", "Tubarão", "Florianópolis"],
            rs: ["Gramado", "Alecrim", "Porto Alegre"],
            pr: ["Cascavel", "Londrina", "Curitiba"]
}

function atualizarCidades() {
            const estadoSelecionado = document.getElementById("estado").value
            const cidadeSelect = document.getElementById("cidade")

            cidadeSelect.innerHTML = '<option value="" disabled selected>Selecione uma cidade</option>'

            if (estadoSelecionado) {
                cidadesPorEstado[estadoSelecionado].forEach(cidade => {
                    let opcao = document.createElement("option")
                    opcao.value = cidade.toLowerCase()
                    opcao.textContent = cidade;
                    cidadeSelect.appendChild(opcao)
                });
            }
        }

    function exibir(){
        const msg = document.getElementById('msg')
        let dados = JSON.parse(localStorage.getItem('pessoas'))

if (dados == null){
    msg.innerHTML = ('Não há dados salvos')
   }

   
    dados.forEach(function(pessoa, index) {
        const linha = document.createElement('div')
        linha.classList.add('linha')

        const botoes = document.createElement('div')
        botoes.classList.add('coluna')
    
        const botaoedit = document.createElement('button')
        botoes.appendChild(botaoedit)
        botaoedit.onclick = function(){
            editar(pessoa, index)
        }

        const botaoremove = document.createElement('button')
        botoes.appendChild(botaoremove)
        botaoremove.onclick = function (){
            remover(pessoa.nome)
        }

        botaoedit.textContent = 'Editar'
        botaoremove.textContent = 'Remover'

        const nomecol = document.createElement('div')
        const telcol = document.createElement('div')
        const estadocol = document.createElement('div')
        const cidadecol = document.createElement('div')

        let nome = document.createElement('div')
        nome.innerHTML += `●${pessoa.nome}`
        

        let tel = document.createElement('div')
            tel.innerHTML += `${pessoa.tel}`
            
            
        let estado =  document.createElement('div')
        estado.innerHTML += `${pessoa.estado}`
        


        let cidade = document.createElement('div')
        cidade.innerHTML += `${pessoa.cidade}`
        
        
        linha.appendChild(nomecol)
        nomecol.appendChild(nome)
        nomecol.style.width = '30%'

        linha.appendChild(telcol)
        telcol.appendChild(tel)
        telcol.classList.add('coluna')
        telcol.style.flex = 0.8


        linha.appendChild(estadocol)
        estadocol.appendChild(estado)
        estadocol.classList.add('coluna')
        estadocol.style.flex = 0.3
    

        linha.appendChild(cidadecol)
        cidadecol.appendChild(cidade)
        cidadecol.classList.add('coluna')

        linha.appendChild(botoes)
    
        msg.appendChild(linha)

    })
}
exibir()
        
function editar(pessoa, index){
   let dados = JSON.parse(localStorage.getItem('pessoas')) || []
   let nome = document.getElementById('nome').value = pessoa.nome
   let tel = document.getElementById('tel').value = pessoa.tel
   let estado = document.getElementById('estado').value = pessoa.estado
   atualizarCidades()
   let cidade = document.getElementById('cidade').value = pessoa.cidade

   const editmodal = document.getElementById('editmodal')
   const modalform = document.getElementById('modalform')
   const buttons = document.createElement('div')
   buttons.classList.add('buttons')

   editmodal.style.display = 'flex'
   modalform.style.display = 'flex'

   backgroundmodal.onclick = sair
   function sair(){
        editmodal.style.display = 'none'
   }
  
   modal.innerHTML = '<strong>Editar dados:<strong>'
   modal.appendChild(modalform) 
   
   const closebutton = document.createElement('button')
   closebutton.textContent = 'Cancelar'
   closebutton.classList.add('closebutton')
   buttons.appendChild(closebutton)
   closebutton.onclick = sair
   function sair(){
        editmodal.style.display = 'none'
        modalform.style.display = 'none'
   }

   const donebutton = document.createElement('button')
   donebutton.textContent = 'Concluido'
   donebutton.classList.add('donebutton')
   buttons.appendChild(donebutton)
   modal.appendChild(buttons)
   donebutton.onclick = function(){
    salvar(index)
   }
}

function salvar(index){
    let dados = JSON.parse(localStorage.getItem('pessoas')) || []

    dados[index] = {
     nome : document.getElementById('nome').value,
     tel : document.getElementById('tel').value,
     estado : document.getElementById('estado').value,
     cidade : document.getElementById('cidade').value
}

    localStorage.setItem('pessoas', JSON.stringify(dados))

    document.location.reload()
}

function remover(nome){
    let dados = JSON.parse(localStorage.getItem('pessoas')) || []
    let index = dados.findIndex(function (param) {
        return param.nome == nome
    })
    console.log(index)
    dados.splice(index, 1)
    console.log(dados)
    localStorage.setItem('pessoas', JSON.stringify(dados))
    document.location.reload()
}

</script>

</body>
</html>